<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<md-tabs flex>
  <md-tab label="Projeto">
    <md-content layout="column" layout-fill flex style="padding: 25px 20px 20px 20px">

      <div layout="row">

        <h2> {{project.project.name}} </h2>

        <md-select aria-label="status"
                   ng-model="project.project.status"
                   ng-change="project.updateProjectStatus( project.project )" style="margin: 0 20px 0 30px">
          <md-option ng-value="status.name" ng-repeat="status in project.status track by $index">
            <div layout="row">
              <div ng-style="{'background-color': status.color}"
                   style="border-radius: 50%; height: 17px; width: 17px;"></div>
              <p style="margin: 0 0 0 10px">{{status.label}}</p>
            </div>
          </md-option>
        </md-select>
        <div flex></div>

        <div layout="row">
          <p> Gerente do Projeto: </p>


          <md-input-container>
            <md-select ng-model="project.project.projectManager"
                       ng-change="project.updateProjectStatus( project.project )">
              <md-option ng-value="user"
                         ng-selected="project.project.projectManager ? user.id == project.project.projectManager.id : null"
                         ng-repeat="user in project.project.members">
                {{user.name}}
              </md-option>
            </md-select>
          </md-input-container>

        </div>


      </div>
      <div layout="row">
        <p> Data de Início </p>
        <p style="font-weight: bold; margin-left: 15px">{{project.project.initialDate | date:'dd/MM/yyyy'}}</p>
        <p style="margin-left: 30px;"> Data de Término </p>
        <p style="font-weight: bold; margin-left: 15px">{{project.project.finalDate | date:'dd/MM/yyyy'}}</p>

        <div flex></div>
        <md-button class="md-raised md-primary" ng-click="project.manageMembers($event, project.project)">
          Gerenciar usuários
        </md-button>
        <md-button class="md-raised md-primary"
                   ng-click="project.manageActivity($event, project.project, null, project.milestones)">
          Criar atividade
        </md-button>
        <md-button class="md-raised md-primary" ng-click="project.manageMilestone($event,project.project)">
          Criar milestone
        </md-button>

      </div>

      <md-divider></md-divider>

      <h3> Atividades do Projeto </h3>


      <div layout="row">

        <div flex>

          <div ng-repeat="activity in project.project.activities" ng-if="project.project.activities.length"
               layout="row">
            <md-checkbox ng-model="activity.status" ng-change="project.updateActivity( activity )"></md-checkbox>
            <div layout="row">
              <p>{{activity.name }}</p>

              <md-input-container>
                <label>Responsável</label>
                <md-select ng-model="activity.owner"
                           ng-change="project.updateActivity( activity )">
                  <md-option ng-value="user"
                             ng-selected="activity.owner ? user.id == activity.owner.id : null"
                             ng-repeat="user in project.project.members">
                    {{user.name}}
                  </md-option>
                </md-select>
              </md-input-container>

            </div>


            <md-button class="md-primary"
                       ng-click="project.manageActivity($event, project.project, activity, project.milestones)">
              Editar
            </md-button>
            <md-button class="md-primary" ng-click="project.removeActivity($event, project.project, activity)">
              Remover
            </md-button>
            <md-button class="md-primary" ng-if="project.activityId != activity.id"
                       ng-click="project.showInfo(activity.id)">
              Visualizar log
            </md-button>
            <md-button class="md-primary" ng-if="project.activityId == activity.id" ng-click="project.closeInfo()">
              Fechar anotações
            </md-button>
          </div>

          <div style="border: 1px solid black; height:60px;" layout layout-align="center center"
               ng-if="!project.project.activities.length">
            <span> O Projeto não possui atividades sem milestone</span>
          </div>

          <md-divider></md-divider>

          <h3> Milestones do Projeto </h3>

          <div ng-repeat="milestone in project.project.milestones" ng-if="project.project.milestones.length">


            <md-subheader class="md-no-sticky">
              <div>

                <div layout="row" style="margin-bottom: 10px;">
                  <h2>
                    {{milestone.name}}
                  </h2>
                  <div layout="row" style="margin-top: 5px; margin-left: 30px;">
                    <p> Data de Início </p>
                    <p style="font-weight: bold; margin-left: 15px">{{milestone.initialDate | date:'dd/MM/yyyy'}}</p>
                    <p style="margin-left: 30px;"> Data de Término </p>
                    <p style="font-weight: bold; margin-left: 15px">{{milestone.finalDate | date:'dd/MM/yyyy'}}</p>
                  </div>
                  <div flex></div>
                  <md-button class="md-primary" ng-click="project.manageMilestone($event,project.project, milestone )">
                    Editar
                  </md-button>
                  <md-button class="md-primary" ng-click="project.removeMilestone($event,project.project, milestone )">
                    Remover
                  </md-button>
                </div>
                <div ng-if="milestone.notes">
                  <p> Observação do Milestone</p>
                  <p>
                    {{milestone.notes}}
                  </p>
                </div>

              </div>

            </md-subheader>

            <div ng-repeat="activity in milestone.activities | orderBy: 'name'" ng-if="milestone.activities.length"
                 layout="row">

              <md-checkbox ng-model="activity.status" ng-change="project.updateActivity( activity )"></md-checkbox>

              <div layout="row">
                <p>{{activity.name }}</p>

                <md-input-container>
                  <label>Responsável</label>
                  <md-select ng-model="activity.owner"
                             ng-change="project.updateActivity( activity )">
                    <md-option ng-value="user"
                               ng-selected="activity.owner ? user.id == activity.owner.id : null"
                               ng-repeat="user in project.project.members">
                      {{user.name}}
                    </md-option>
                  </md-select>
                </md-input-container>

              </div>

              <md-button class="md-primary"
                         ng-click="project.manageActivity($event, project.project, activity, milestone)">
                Editar
              </md-button>
              <md-button class="md-primary"
                         ng-click="project.removeActivity($event, project.project, activity, milestone)">
                Remover
              </md-button>

            </div>
            <div style="padding: 0px 20px 0px 20px;">
              <div style="border: 1px solid black; height:60px;" layout layout-align="center center"
                   ng-if="!milestone.activities.length">
                <span> O Milestone {{milestone.name}} não possui atividades</span>
              </div>
            </div>

            <md-divider></md-divider>
          </div>
          <div style="border: 1px solid black; height:60px;" layout layout-align="center center"
               ng-if="!project.project.milestones.length">
            <span> O Projeto não possui milestones</span>
          </div>
        </div>


        <div ng-if="project.info" flex="30" style="background: #25caff;">
          <md-tabs md-dynamic-height md-border-bottom>
            <md-tab label="Comentários">

              <div>
                <md-input-container>
                  <label>Novo comentário</label>
                  <input class="form-control" placeholder="Novo comentário" ng-model="project.newAnnotation.note"/>
                </md-input-container>
                <md-button class="md-raised md-primary" ng-click="project.insertAnnotation( project.newAnnotation)">
                  Salvar
                </md-button>

              </div>

              <md-content class="md-padding" style="background: #4cd8ff;">
                <div ng-repeat="annotation in project.annotations">
                  <div layout="column">

                    <span>{{annotation.note}}</span>

                    <div layout="row">
                      <span> {{annotation.created | date:"dd-MM-yyyy hh:mm "}} </span>
                      <span> por {{annotation.createdBy.name}}</span>
                    </div>

                    <md-divider></md-divider>
                  </div>


                </div>
              </md-content>
            </md-tab>
          </md-tabs>

        </div>

      </div>


    </md-content>

  </md-tab>
  <md-tab label="Calendario">
    <md-content>
      Oiee
      <calendar-md flex layout layout-fill
                   calendar-direction="direction"
                   on-prev-month="prevMonth"
                   on-next-month="nextMonth"
                   on-day-click="dayClick"
                   title-format="'MMMM y'"
                   ng-model='selectedDate'
                   week-starts-on="firstDayOfWeek"
                   data-start-month="8"
                   data-start-year="2014"
                   tooltips="tooltips"
                   day-format="dayFormat"
                   day-label-format="'EEE'"
                   day-label-tooltip-format="'EEEE'"
                   day-tooltip-format="'fullDate'"
                   day-content="setDayContent"
                   disable-future-selection="false">

      </calendar-md>

      <script>
        angular.module("materialExample", ["ngMaterial", "materialCalendar"]);

        angular.module("materialExample").controller("calendarCtrl", function ($scope, $filter, $http, $q) {

          $scope.dayFormat = "d";

          // To select a single date, make sure the ngModel is not an array.
          $scope.selectedDate = null;

          // If you want multi-date select, initialize it as an array.
          $scope.selectedDate = [];

          $scope.firstDayOfWeek = 0; // First day of the week, 0 for Sunday, 1 for Monday, etc.
          $scope.setDirection = function (direction) {
            $scope.direction = direction;
            $scope.dayFormat = direction === "vertical" ? "EEEE, MMMM d" : "d";
          };

          $scope.dayClick = function (date) {
            $scope.msg = "You clicked " + $filter("date")(date, "MMM d, y h:mm:ss a Z");
          };

          $scope.prevMonth = function (data) {
            $scope.msg = "You clicked (prev) month " + data.month + ", " + data.year;
          };

          $scope.nextMonth = function (data) {
            $scope.msg = "You clicked (next) month " + data.month + ", " + data.year;
          };

          $scope.tooltips = true;
          $scope.setDayContent = function (date) {

            // You would inject any HTML you wanted for
            // that particular date here.
            return "<p></p>";

            // You could also use an $http function directly.
            return $http.get("/some/external/api");

            // You could also use a promise.
            var deferred = $q.defer();
            $timeout(function () {
              deferred.resolve("<p></p>");
            }, 1000);
            return deferred.promise;

          };

        });
      </script>
    </md-content>
  </md-tab>
</md-tabs>
</body>
</html>
